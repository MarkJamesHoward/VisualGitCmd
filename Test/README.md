Repo moved to = https://github.com/MarkJamesHoward/Visual-Git



# Docker Output Integration Tests

## Overview
This test suite validates that the JSON output generated by Docker containers matches the expected baseline files stored in `Test/ExpectedJson`.

## Test Files
The following JSON files are compared:
- `BlobGitInJson.json`
- `CommitGitInJson.json`
- `IndexfilesGitInJson.json`
- `TreeGitInJson.json`

## Prerequisites

### 1. Build and Run Docker Container
```powershell
# Build the Docker image
docker build -t visualgit -f Docker/DockerFileLinuxTest .

# Run the container with volume mapping to generate output
docker-compose up -d
```

### 2. Ensure Output Directory Exists
The tests expect output files at: `c:\dev\output`

Make sure your Docker container is configured to write output to this location (already configured in `docker-compose.yaml`).

## Running the Tests

### Run All Integration Tests
```powershell
dotnet test --filter "FullyQualifiedName~DockerOutputIntegrationTests"
```

### Run Individual File Comparison Tests
```powershell
# Test a specific file
dotnet test --filter "FullyQualifiedName~DockerOutputIntegrationTests.DockerOutput_ShouldMatchExpectedJson"

# Test all files at once
dotnet test --filter "FullyQualifiedName~DockerOutputIntegrationTests.DockerOutput_AllFilesShouldMatchExpectedJson"
```

### Run File Existence Check
```powershell
dotnet test --filter "FullyQualifiedName~DockerOutputIntegrationTests.DockerOutput_AllExpectedFilesPresent"
```

## Test Structure

### Individual File Tests (`DockerOutput_ShouldMatchExpectedJson`)
- Tests each JSON file independently using xUnit Theory
- Provides specific failure information per file
- Uses normalized JSON comparison to ignore formatting differences

### Aggregate Test (`DockerOutput_AllFilesShouldMatchExpectedJson`)
- Validates all files in a single test
- Quick smoke test to verify entire output
- Lists all failures at once

### Existence Tests
- `DockerOutput_AllExpectedFilesPresent`: Verifies all expected files exist in output directory
- `ExpectedJson_AllFilesPresent`: Verifies all baseline files exist in Test/ExpectedJson

## Troubleshooting

### Tests Fail with "File Not Found"
1. Verify Docker container is running: `docker ps`
2. Check volume mapping in `docker-compose.yaml`
3. Verify output directory exists: `c:\dev\output`
4. Run the application in Docker to generate output

### Tests Fail with "Content Mismatch"
1. Manually compare files to identify differences
2. If Docker output is correct, update expected files:
   ```powershell
   Copy-Item "c:\dev\output\*.json" "Test\ExpectedJson\" -Force
   ```
3. Re-run tests to verify

### JSON Parse Errors
- Ensure Docker container completed successfully
- Check that JSON files are not corrupted or empty
- Review application logs for generation errors

## CI/CD Integration

Add to your pipeline:
```yaml
- name: Run Integration Tests
  run: |
    docker-compose up -d
    Start-Sleep -Seconds 10  # Wait for container to generate output
    dotnet test --filter "FullyQualifiedName~DockerOutputIntegrationTests"
    docker-compose down
```

## Updating Expected Results

When application behavior changes intentionally:
```powershell
# 1. Generate new output via Docker
docker-compose up -d

# 2. Verify output looks correct manually
Get-Content c:\dev\output\BlobGitInJson.json

# 3. Update expected files
Copy-Item "c:\dev\output\*.json" "Test\ExpectedJson\" -Force

# 4. Commit updated expectations
git add Test/ExpectedJson/*.json
git commit -m "Update expected JSON test results"
```
